class SmoothScrollGenerator extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.elements={},this.eventHandlers=new Map,this.initialized=!1,this.presets={standard:{description:"Сбалансированная настройка",lerp:.1,duration:1.2,wheelMultiplier:1,excludeSelectors:""},smooth:{description:"Максимально плавная прокрутка",lerp:.05,duration:1.8,wheelMultiplier:.7,excludeSelectors:""}}}async connectedCallback(){this.initialized||(await this.init(),this.initialized=!0)}disconnectedCallback(){this.destroy()}async init(){await this.render(),this.findElements(),this.bindEvents(),this.setInitialState()}async render(){const e=this.getTemplate(),t=this.getStyles();this.shadowRoot.innerHTML=`\n      <style>${t}</style>\n      ${e}\n    `}getStyles(){return":host{box-sizing:border-box;display:block;font-family:Inter,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial,sans-serif;max-width:100%;width:100%}*{box-sizing:border-box}.smooth-scroll-generator{--primary-color:#4483f5;--primary-light:rgba(68,131,245,.15);--primary-gradient:linear-gradient(90deg,#4483f5,#5e6ffd);--text-dark:#333;--text-light:#777;--border-color:#ddd;--bg-light:#f8f9fa;--shadow-sm:0 2px 5px rgba(0,0,0,.05);--shadow-md:0 4px 12px rgba(0,0,0,.08);--radius-sm:6px;--radius-md:10px;--transition:all 0.2s ease;background:linear-gradient(180deg,#f8f9fa,#f0f3f7);border:1px solid rgba(0,0,0,.05);border-radius:var(--radius-md);box-shadow:var(--shadow-md);color:var(--text-dark);min-width:350px;padding:15px;width:100%}.form-grid{background:#fff;border-radius:var(--radius-md);box-shadow:var(--shadow-sm);display:flex;flex-direction:column;gap:20px;margin-bottom:20px;max-height:calc(100vh - 348px);overflow:auto;padding:15px;width:100%}fieldset{border:none;margin:0;padding:0}legend{border-bottom:2px solid var(--bg-light);color:var(--text-dark);font-size:16px;font-weight:600;margin-bottom:15px;padding-bottom:8px;width:100%}.setting-group{display:flex;flex-direction:column;gap:15px}.setting-group label{align-items:center;color:var(--text-dark);display:flex;font-size:14px;font-weight:500}.number-input,.select-styled,.text-input{border:1px solid var(--border-color);border-radius:var(--radius-sm);box-shadow:var(--shadow-sm);color:var(--text-dark);font-size:14px;padding:8px 10px;transition:var(--transition);width:100%}.select-styled{appearance:none;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3E%3C/svg%3E\");background-position:right 8px center;background-repeat:no-repeat;background-size:16px;cursor:pointer;padding-right:32px}.number-input:focus,.select-styled:focus,.text-input:focus{border-color:var(--primary-color);box-shadow:0 0 0 3px var(--primary-light);outline:none}.helper-text{color:var(--text-light);font-size:13px;line-height:1.4;margin:0}.helper-text:not(:last-child){margin-bottom:15px}.slider-container{display:flex;flex-direction:column;gap:10px}.slider{-webkit-appearance:none;background:#e0e0e0;border-radius:2px;height:4px;margin:15px 0;outline:none;width:100%}.slider::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;background:var(--primary-color);border:2px solid #fff;border-radius:50%;box-shadow:0 0 0 5px rgba(68,131,245,.2);cursor:pointer;height:20px;transition:all .2s ease;width:20px}.slider::-moz-range-thumb{background:var(--primary-color);border:2px solid #fff;border-radius:50%;box-shadow:0 0 0 5px rgba(68,131,245,.2);cursor:pointer;height:20px;transition:all .2s ease;width:20px}.slider::-moz-range-thumb:hover,.slider::-webkit-slider-thumb:hover{box-shadow:0 0 0 7px rgba(68,131,245,.3)}.slider:active::-moz-range-thumb,.slider:active::-webkit-slider-thumb{box-shadow:0 0 0 10px rgba(68,131,245,.4)}.slider-labels{color:var(--text-light);display:flex;font-size:12px;justify-content:space-between}.slider-value{align-items:center;display:flex;font-size:14px;gap:10px}.slider-value-primary{color:var(--primary-color);font-weight:600}.slider-value-secondary{color:var(--text-light)}.tabs-container{display:flex;flex-direction:column;gap:15px}.tab-buttons{background:var(--bg-light);border-radius:var(--radius-sm);display:flex;gap:2px;padding:4px}.tab-button{background:transparent;border:none;border-radius:var(--radius-sm);color:var(--text-light);cursor:pointer;flex:1;font-size:14px;font-weight:500;padding:8px 12px;transition:var(--transition)}.tab-button.active{background:#fff;box-shadow:var(--shadow-sm);color:var(--text-dark)}.tab-content{display:none}.tab-content.active{display:block}.settings-column{display:flex;flex-direction:column;gap:20px}.checkbox-container{align-items:center;cursor:pointer;display:flex;gap:10px;margin:0}.checkbox-container input[type=checkbox]{cursor:pointer;flex-shrink:0;height:18px;margin:0;width:18px}.checkbox-option-label{color:var(--text-dark);cursor:pointer;font-size:14px;line-height:1.4}.keyboard-option{display:none}.keyboard-option.visible{display:block}.action-section{display:flex;justify-content:center;margin-top:20px}.generate-button{align-items:center;background:var(--primary-gradient);border:none;border-radius:var(--radius-sm);box-shadow:0 4px 12px rgba(68,131,245,.3);color:#fff;cursor:pointer;display:flex;font-size:16px;font-weight:500;gap:8px;padding:12px 24px;transition:var(--transition)}.generate-button:hover{box-shadow:0 6px 16px rgba(68,131,245,.4);transform:translateY(-2px)}.generate-button:active{box-shadow:0 2px 8px rgba(68,131,245,.3);transform:translateY(0)}"}getTemplate(){return'<form class="smooth-scroll-generator"><div class="form-grid"><fieldset><legend>Готовые пресеты</legend><div class="setting-group"><label for="preset-select">Выберите пресет:</label><select id="preset-select" class="select-styled"><option value="standard">Стандартный</option><option value="smooth">Плавный</option></select><div class="helper-text" id="preset-description">Рекомендованные настройки Lenis</div></div></fieldset><fieldset><legend>Точная настройка</legend><div class="settings-column"><div class="setting-group"><label for="lerp-slider">Интенсивность плавности:</label><div class="slider-container"><input type="range" id="lerp-slider" min="1" max="100" value="50" class="slider"><div class="slider-labels"><span>Менее плавная</span><span>Очень плавная</span></div><div class="slider-value"><span id="lerp-value-display" class="slider-value-primary">0.1</span></div></div><div class="helper-text">Чем выше процент, тем более плавная прокрутка</div></div><div class="setting-group"><label for="speed-slider">Скорость прокрутки:</label><div class="slider-container"><input type="range" id="speed-slider" min="1" max="100" value="50" class="slider"><div class="slider-labels"><span>Медленная</span><span>Быстрая</span></div><div class="slider-value"><span id="speed-value-display" class="slider-value-primary">1.0x</span></div></div><div class="helper-text">Как быстро прокрутка реагирует на движения мыши/тачпада</div></div><div class="setting-group"><label for="exclude-selectors">Исключить элементы (опционально):</label><input id="exclude-selectors" class="text-input" placeholder="map, slider, gallery"><div class="helper-text">Классы элементов (через запятую, без точек)</div></div></div></fieldset></div><div class="action-section"><button type="button" class="generate-button" id="generate-btn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M16 18l6-6-6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 6l-6 6 6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><span>Сгенерировать код</span></button></div></form>'}findElements(){const e={presetSelect:this.shadowRoot.getElementById("preset-select"),presetDescription:this.shadowRoot.getElementById("preset-description"),lerpSlider:this.shadowRoot.getElementById("lerp-slider"),lerpValueDisplay:this.shadowRoot.getElementById("lerp-value-display"),speedSlider:this.shadowRoot.getElementById("speed-slider"),speedValueDisplay:this.shadowRoot.getElementById("speed-value-display"),excludeSelectors:this.shadowRoot.getElementById("exclude-selectors"),generateButton:this.shadowRoot.getElementById("generate-btn")};e.successPopup=document.querySelector(".pop-up-success"),e.popupAcceptBtn=document.querySelector("[data-popup-accept-btn]"),e.popupCloseBtn=document.querySelector("[data-popup-close-btn]"),this.elements=e}bindEvents(){const e={handleGenerate:this.generateAndCopyCode.bind(this),handlePresetChange:e=>this.applyPreset(e.target.value),handleLerpInput:()=>this.updateLerpUI(),handleSpeedInput:()=>this.updateSpeedUI()};this.eventHandlers=e,this.elements.generateButton?.addEventListener("click",e.handleGenerate),this.elements.presetSelect?.addEventListener("change",e.handlePresetChange),this.elements.lerpSlider?.addEventListener("input",e.handleLerpInput),this.elements.speedSlider?.addEventListener("input",e.handleSpeedInput),this.bindModalEvents()}unbindEvents(){this.eventHandlers&&(this.elements.generateButton?.removeEventListener("click",this.eventHandlers.handleGenerate),this.elements.presetSelect?.removeEventListener("change",this.eventHandlers.handlePresetChange),this.elements.lerpSlider?.removeEventListener("input",this.eventHandlers.handleLerpInput),this.elements.speedSlider?.removeEventListener("input",this.eventHandlers.handleSpeedInput),this.eventHandlers.has("popup-accept")&&this.elements.popupAcceptBtn?.removeEventListener("click",this.eventHandlers.get("popup-accept")),this.eventHandlers.has("popup-close")&&this.elements.popupCloseBtn?.removeEventListener("click",this.eventHandlers.get("popup-close")),this.eventHandlers.has("popup-overlay")&&this.elements.successPopup?.removeEventListener("click",this.eventHandlers.get("popup-overlay")),this.eventHandlers.clear())}destroy(){this.unbindEvents(),this.initialized=!1,console.log("SmoothScrollGenerator: Генератор уничтожен")}setInitialState(){this.elements.presetSelect&&this.applyPreset(this.elements.presetSelect.value),this.updateLerpUI(),this.updateSpeedUI()}applyPreset(e){const t=this.presets[e];if(!t)return;const{presetDescription:s,lerpSlider:n,speedSlider:i,excludeSelectors:r}=this.elements;if(s&&(s.textContent=t.description),n){const e=Math.round((.1-t.lerp)/.05*99+1);n.value=Math.max(1,Math.min(100,e))}if(i){const e=Math.round(50*t.wheelMultiplier);i.value=e}r&&(r.value=t.excludeSelectors),this.updateLerpUI(),this.updateSpeedUI()}updateLerpUI(){const{lerpSlider:e,lerpValueDisplay:t}=this.elements;if(!e||!t)return;const s=parseInt(e.value,10)||50,n=Math.round((s-1)/99*100);t.textContent=`${n}%`}updateSpeedUI(){const{speedSlider:e,speedValueDisplay:t}=this.elements;if(!e||!t)return;const s=((parseInt(e.value,10)||50)/50).toFixed(1);t.textContent=`${s}x`}collectData(){const e=parseInt(this.elements.lerpSlider?.value,10)||50,t=parseInt(this.elements.speedSlider?.value,10)||50;return{lerp:Math.max(.05,Math.min(.1,.1-(e-1)/99*.05)),duration:1.2,wheelMultiplier:t/50,excludeSelectors:(this.elements.excludeSelectors?.value||"").trim()}}generateCode(e={}){const t=this._getExcludeSelectorsCode(e.excludeSelectors);return`<script>\n(function() {\n  if (window.lenisInitialized) return;\n  window.lenisInitialized = true;\n  \n  // Плавная прокрутка с поддержкой якорных ссылок\n  // Любые ссылки вида <a href="#section"> будут автоматически прокручиваться плавно\n  \n  // Подключение Lenis\n  const script = document.createElement('script');\n  script.src = 'https://cdn.jsdelivr.net/npm/@studio-freight/lenis@1.0.42/dist/lenis.min.js';\n  script.onload = function() {\n    ${this._getLenisCSS()}\n    ${t}\n    \n    // Инициализация Lenis с поддержкой якорных ссылок\n    const lenis = new Lenis({\n      lerp: ${e.lerp.toFixed(3)},\n      duration: ${e.duration.toFixed(1)},\n      wheelMultiplier: ${e.wheelMultiplier.toFixed(1)},\n      anchors: true, // Автоматическая плавная прокрутка для ссылок <a href="#section">\n      gestureOrientation: 'vertical',\n      normalizeWheel: false,\n      smoothTouch: false\n    });\n    \n    // Добавление класса к HTML для CSS стилей\n    document.documentElement.classList.add('lenis');\n    \n    // Запуск анимации\n    function raf(time) {\n      lenis.raf(time);\n      requestAnimationFrame(raf);\n    }\n    requestAnimationFrame(raf);\n    \n    // Глобальный доступ для отладки\n    window.lenis = lenis;\n  };\n  document.head.appendChild(script);\n})();\n<\/script>`}_getExcludeSelectorsCode(e){if(!e)return"// Нет исключаемых элементов";const t=e.split(",").map(e=>e.trim()).filter(Boolean);return t.length?`\n    // Добавление data-lenis-prevent атрибутов к исключаемым элементам\n    const excludeClasses = [${t.map(e=>`'${e}'`).join(", ")}];\n    excludeClasses.forEach(className => {\n      document.querySelectorAll('.' + className).forEach(element => {\n        element.setAttribute('data-lenis-prevent', 'true');\n      });\n    });`:"// Нет исключаемых элементов"}_getLenisCSS(){return"\n    // Добавление обязательных CSS стилей для Lenis\n    const style = document.createElement('style');\n    style.textContent = `\n      html.lenis, html.lenis body {\n        height: auto;\n      }\n      .lenis.lenis-smooth {\n        scroll-behavior: auto !important;\n      }\n      .lenis.lenis-smooth [data-lenis-prevent] {\n        overscroll-behavior: contain;\n      }\n      .lenis.lenis-stopped {\n        overflow: hidden;\n      }\n      .lenis.lenis-smooth iframe {\n        pointer-events: none;\n      }\n    `;\n    document.head.appendChild(style);"}async minifyGeneratedCode(e){try{const t=this.parseGeneratedCode(e),s=t.js?this.minifyJS(t.js):"",n=t.html?this.minifyHTML(t.html):"";let i="";return n&&(i+=n),s&&(i+=`<script>${s}<\/script>`),i}catch(t){return console.warn("Минификация генерируемого кода не удалась, используем оригинал:",t),e}}parseGeneratedCode(e){const t={js:"",html:""},s=/<script[^>]*>([\s\S]*?)<\/script>/gi;let n;for(;null!==(n=s.exec(e));)t.js+=n[1];return t.html=e.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").trim(),t}minifyHTML(e){return e?e.replace(/<!--[\s\S]*?-->/g,"").replace(/>\s+</g,"><").replace(/\s+/g," ").trim():""}minifyJS(e){let t=e;return t=this.removeJSComments(t),t=t.replace(/const\s+([a-zA-Z_$][a-zA-Z0-9_$]*)\s*=\s*/g,"const $1=").replace(/let\s+([a-zA-Z_$][a-zA-Z0-9_$]*)\s*=\s*/g,"let $1=").replace(/var\s+([a-zA-Z_$][a-zA-Z0-9_$]*)\s*=\s*/g,"var $1="),t=t.replace(/{\s*([^}]+)\s*}/g,(e,t)=>`{${t.replace(/\s*:\s*/g,":").replace(/\s*,\s*/g,",")}}`).replace(/\[\s*([^\]]+)\s*\]/g,(e,t)=>`[${t.replace(/\s*,\s*/g,",")}]`),t=t.replace(/\s*([=+\-*/%<>&|!])\s*/g,"$1").replace(/\s*([(){}[\];,])\s*/g,"$1").replace(/\s+/g," ").replace(/\b(if|for|while|switch|catch|function|return|throw|new|typeof)\s+/g,"$1 ").replace(/\belse\s+/g,"else ").replace(/\s*\n\s*/g,"\n").replace(/\n+/g,"\n").trim(),t=t.replace(/\btrue\b(?=\s*[,;\}\)\]])/g,"!0").replace(/\bfalse\b(?=\s*[,;\}\)\]])/g,"!1").replace(/\bundefined\b(?=\s*[,;\}\)\]])/g,"void 0"),t}removeJSComments(e){let t="",s=!1,n="",i=!1,r=!1;for(let o=0;o<e.length;o++){const l=e[o],a=e[o+1]||"";if(!i&&!r){if(!(s||'"'!==l&&"'"!==l&&"`"!==l)){s=!0,n=l,t+=l;continue}if(s&&l===n&&"\\"!==e[o-1]){s=!1,t+=l;continue}if(s){t+=l;continue}}if(!s){if(!i&&!r&&"/"===l&&"*"===a){i=!0,o++;continue}if(i&&"*"===l&&"/"===a){i=!1,o++;continue}if(!i&&!r&&"/"===l&&"/"===a){r=!0,o++;continue}if(r&&("\n"===l||"\r"===l)){r=!1,t+=l;continue}}i||r||(t+=l)}return t}async generateAndCopyCode(){const e=this.collectData(),t=this.generateCode(e),s=await this.minifyGeneratedCode(t);try{await this.copyToClipboard(s),this.showSuccessPopup()}catch(e){console.error("Не удалось скопировать код:",e)}}bindModalEvents(){if(this.elements.popupAcceptBtn){const e=()=>this.hideSuccessPopup();this.eventHandlers.set("popup-accept",e),this.elements.popupAcceptBtn.addEventListener("click",e)}if(this.elements.popupCloseBtn){const e=()=>this.hideSuccessPopup();this.eventHandlers.set("popup-close",e),this.elements.popupCloseBtn.addEventListener("click",e)}if(this.elements.successPopup){const e=e=>{e.target===this.elements.successPopup&&this.hideSuccessPopup()};this.eventHandlers.set("popup-overlay",e),this.elements.successPopup.addEventListener("click",e)}}async copyToClipboard(e){if(navigator.clipboard)try{return void await navigator.clipboard.writeText(e)}catch(e){console.log("Ошибка clipboard API:",e)}const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",t.style.left="-9999px",document.body.appendChild(t);try{t.select(),document.execCommand("copy")}finally{document.body.removeChild(t)}}showSuccessPopup(){this.elements.successPopup&&(this.elements.successPopup.style.display="flex")}hideSuccessPopup(){this.elements.successPopup&&(this.elements.successPopup.style.display="none")}}customElements.define("smooth-scroll-generator",SmoothScrollGenerator);