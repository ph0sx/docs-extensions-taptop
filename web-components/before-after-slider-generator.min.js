class BeforeAfterSliderGenerator extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.elements={},this.eventHandlers=new Map,this.initialized=!1,this.configDefaults={imageUrlBefore:"",imageUrlAfter:"",containerSelector:"",initialPosition:50,orientation:"horizontal",hoverMode:!1,handleOnlyDrag:!1,dividerWidth:1,dividerColor:"#ffffff",handleWidth:40,handleColor:"#ffffff",hideHandle:!1}}async connectedCallback(){this.initialized||(await this.init(),this.initialized=!0)}disconnectedCallback(){this.destroy()}async init(){await this.render(),this.findElements(),this.bindEvents(),this.setInitialState()}async render(){const e=this.getTemplate(),t=this.getStyles();this.shadowRoot.innerHTML=`\n      <style>${t}</style>\n      ${e}\n    `}getStyles(){return":host{box-sizing:border-box;display:block;font-family:Inter,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial,sans-serif;max-width:100%;width:100%}*{box-sizing:border-box}.before-after-slider-generator{--primary-color:#4483f5;--primary-light:rgba(68,131,245,.15);--primary-gradient:linear-gradient(90deg,#4483f5,#5e6ffd);--text-dark:#333;--text-light:#777;--border-color:#ddd;--bg-light:#f8f9fa;--shadow-sm:0 2px 5px rgba(0,0,0,.05);--shadow-md:0 4px 12px rgba(0,0,0,.08);--radius-sm:6px;--radius-md:10px;--transition:all 0.2s ease;background:linear-gradient(180deg,#f8f9fa,#f0f3f7);border:1px solid rgba(0,0,0,.05);border-radius:var(--radius-md);box-shadow:var(--shadow-md);color:var(--text-dark);min-width:350px;padding:15px;width:100%}.form-grid{background:#fff;border-radius:var(--radius-md);box-shadow:var(--shadow-sm);display:flex;flex-direction:column;gap:20px;margin-bottom:20px;max-height:calc(100vh - 348px);overflow:auto;padding:15px;width:100%}fieldset{border:none;margin:0;padding:0}legend{border-bottom:2px solid var(--bg-light);color:var(--text-dark);font-size:16px;font-weight:600;margin-bottom:15px;padding-bottom:8px;width:100%}.setting-group{display:flex;flex-direction:column;gap:15px}.setting-group label{align-items:center;color:var(--text-dark);display:flex;font-size:14px;font-weight:500}.number-input,.select-styled,.text-input{border:1px solid var(--border-color);border-radius:var(--radius-sm);box-shadow:var(--shadow-sm);color:var(--text-dark);font-size:14px;padding:8px 10px;transition:var(--transition);width:100%}.number-input:focus,.select-styled:focus,.text-input:focus{border-color:var(--primary-color);box-shadow:0 0 0 3px var(--primary-light);outline:none}.select-styled{appearance:none;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3E%3C/svg%3E\");background-position:right 8px center;background-repeat:no-repeat;background-size:16px;cursor:pointer;padding-right:32px}.helper-text{color:var(--text-light);font-size:13px;line-height:1.4;margin:0}.helper-text:not(:last-child){margin-bottom:15px}.slider-container{display:flex;flex-direction:column;gap:10px}.slider{-webkit-appearance:none;background:#e0e0e0;border-radius:2px;height:4px;margin:15px 0;outline:none;width:100%}.slider::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;background:var(--primary-color);border:2px solid #fff;border-radius:50%;box-shadow:0 0 0 5px rgba(68,131,245,.2);cursor:pointer;height:20px;transition:all .2s ease;width:20px}.slider::-moz-range-thumb{background:var(--primary-color);border:2px solid #fff;border-radius:50%;box-shadow:0 0 0 5px rgba(68,131,245,.2);cursor:pointer;height:20px;transition:all .2s ease;width:20px}.slider::-moz-range-thumb:hover,.slider::-webkit-slider-thumb:hover{box-shadow:0 0 0 7px rgba(68,131,245,.3)}.slider:active::-moz-range-thumb,.slider:active::-webkit-slider-thumb{box-shadow:0 0 0 10px rgba(68,131,245,.4)}.slider-labels{color:var(--text-light);display:flex;font-size:12px;justify-content:space-between}.slider-value{align-items:center;display:flex;font-size:14px;gap:10px}.slider-value-primary{color:var(--primary-color);font-weight:600}.radio-group{display:flex;flex-direction:column;gap:15px}.radio-container{align-items:center;color:var(--text-dark);cursor:pointer;display:inline-flex;font-size:14px;margin-bottom:5px;padding-left:30px;position:relative;user-select:none}.radio-container input[type=radio]{cursor:pointer;height:0;opacity:0;position:absolute;width:0}.radio-checkmark{background-color:#f0f0f0;border:1px solid #ccc;border-radius:50%;box-shadow:inset 0 1px 2px rgba(0,0,0,.1);height:20px;left:0;position:absolute;transition:all .2s ease;width:20px}.radio-container:hover input[type=radio]~.radio-checkmark{background-color:#e0e0e0;border-color:#bbb}.radio-container input[type=radio]:checked~.radio-checkmark{background-color:var(--primary-color);border-color:var(--primary-color);box-shadow:none}.radio-checkmark:after{background:#fff;border-radius:50%;content:\"\";display:none;height:8px;left:5px;position:absolute;top:5px;width:8px}.radio-container input[type=radio]:checked~.radio-checkmark:after{display:block}.checkbox-container{align-items:center;cursor:pointer;display:flex;gap:10px;margin:0}.checkbox-container input[type=checkbox]{cursor:pointer;flex-shrink:0;height:18px;margin:0;width:18px}.checkbox-option-label{color:var(--text-dark);cursor:pointer;font-size:14px;line-height:1.4}.color-input{background:none;border:1px solid var(--border-color);border-radius:var(--radius-sm);cursor:pointer;height:40px;padding:0;width:60px}.color-input:focus{border-color:var(--primary-color);box-shadow:0 0 0 3px var(--primary-light);outline:none}.settings-column{display:flex;flex-direction:column;gap:20px}.settings-row{display:flex;flex-wrap:wrap;gap:15px}.settings-row .setting-group{flex:1;gap:10px;min-width:120px}.action-section{display:flex;justify-content:center;margin-top:20px}.generate-button{align-items:center;background:var(--primary-gradient);border:none;border-radius:var(--radius-sm);box-shadow:0 4px 12px rgba(68,131,245,.3);color:#fff;cursor:pointer;display:flex;font-size:16px;font-weight:500;gap:8px;padding:12px 24px;transition:var(--transition)}.generate-button:hover{box-shadow:0 6px 16px rgba(68,131,245,.4);transform:translateY(-2px)}.generate-button:active{box-shadow:0 2px 8px rgba(68,131,245,.3);transform:translateY(0)}.preview-container{background:#fafafa;border:2px dashed var(--border-color);border-radius:var(--radius-md);height:300px;margin-top:15px;max-height:400px;overflow:hidden;position:relative}.preview-area,.preview-container{align-items:center;display:flex;justify-content:center;width:100%}.preview-area{height:100%}.preview-placeholder{color:var(--text-light);position:absolute}.preview-error,.preview-placeholder{font-size:14px;padding:20px;text-align:center}.preview-error{background:rgba(231,76,60,.1);border-radius:var(--radius-sm);color:#e74c3c;display:none;margin:10px}.preview-settings{margin-bottom:15px}img-comparison-slider{outline:none!important}"}getTemplate(){return'<form class="before-after-slider-generator"><div class="form-grid"><fieldset><legend>Основные настройки</legend><div class="setting-group"><div class="setting-group"><label for="image-url-before">URL изображения "До":</label><input type="url" id="image-url-before" class="text-input" placeholder="https://example.com/before.jpg"><div class="helper-text">Ссылка на изображение, которое будет показано в левой/верхней части</div></div><div class="setting-group"><label for="image-url-after">URL изображения "После":</label><input type="url" id="image-url-after" class="text-input" placeholder="https://example.com/after.jpg"><div class="helper-text">Ссылка на изображение, которое будет показано в правой/нижней части</div></div><div class="setting-group"><label for="container-selector">CSS-класс контейнера:</label><input id="container-selector" class="text-input" placeholder="slider-container"><div class="helper-text">Класс блока, в который будет добавлен слайдер (без точки)</div></div><div class="setting-group"><label for="initial-position">Начальная позиция разделителя:</label><div class="slider-container"><input type="range" id="initial-position" min="0" max="100" value="50" class="slider"><div class="slider-labels"><span>0%</span><span>100%</span></div><div class="slider-value"><span id="initial-position-value" class="slider-value-primary">50%</span></div></div><div class="helper-text">Где будет располагаться разделитель при загрузке страницы</div></div></div></fieldset><fieldset><legend>Поведение слайдера</legend><div class="setting-group"><div class="setting-group"><label>Ориентация слайдера:</label><div class="radio-group"><label class="radio-container"><input type="radio" name="orientation" value="horizontal" checked><span class="radio-checkmark"></span>Горизонтальная (слева-направо)</label><label class="radio-container"><input type="radio" name="orientation" value="vertical"><span class="radio-checkmark"></span>Вертикальная (сверху-вниз)</label></div><div class="helper-text">Направление движения разделителя</div></div><div class="setting-group"><label class="checkbox-container"><input type="checkbox" id="hover-mode"><span class="checkbox-option-label">Режим наведения</span></label><div class="helper-text">Слайдер будет следовать за курсором мыши при наведении</div></div><div class="setting-group"><label class="checkbox-container"><input type="checkbox" id="handle-only-drag"><span class="checkbox-option-label">Перетаскивание только за ручку</span></label><div class="helper-text">Слайдер можно будет двигать только за ручку, а не по всей области</div></div></div></fieldset><fieldset><legend>Внешний вид</legend><div class="settings-column"><div class="setting-group"><label for="divider-width">Толщина разделителя (px):</label><input type="number" id="divider-width" class="number-input" value="1" min="0" max="10"><div class="helper-text">Ширина линии между изображениями</div></div><div class="setting-group"><label for="divider-color">Цвет разделителя:</label><input type="color" id="divider-color" class="color-input" value="#ffffff"><div class="helper-text">Цвет линии разделителя</div></div><div class="setting-group"><label for="handle-width">Размер ручки (px):</label><input type="number" id="handle-width" class="number-input" value="40" min="20" max="80"><div class="helper-text">Размер круглой ручки для перетаскивания</div></div><div class="setting-group"><label for="handle-color">Цвет ручки:</label><input type="color" id="handle-color" class="color-input" value="#ffffff"><div class="helper-text">Цвет круглой ручки</div></div><div class="setting-group"><label class="checkbox-container"><input type="checkbox" id="hide-handle"><span class="checkbox-option-label">Скрыть ручку</span></label><div class="helper-text">Сделать ручку невидимой (слайдер останется функциональным)</div></div></div></fieldset><fieldset><legend>Предпросмотр</legend><div class="setting-group"><div class="preview-container" id="preview-container"><div id="preview-area" class="preview-area"></div><div id="preview-placeholder" class="preview-placeholder">Укажите URL изображений для предпросмотра</div><div id="preview-error" class="preview-error"></div></div></div></fieldset></div><div class="action-section"><button type="button" class="generate-button" id="generate-btn"><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M16 18l6-6-6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M8 6l-6 6 6 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><span>Сгенерировать код</span></button></div></form>'}findElements(){const e={imageUrlBefore:this.shadowRoot.getElementById("image-url-before"),imageUrlAfter:this.shadowRoot.getElementById("image-url-after"),containerSelector:this.shadowRoot.getElementById("container-selector"),initialPosition:this.shadowRoot.getElementById("initial-position"),initialPositionValue:this.shadowRoot.getElementById("initial-position-value"),orientationRadios:this.shadowRoot.querySelectorAll('input[name="orientation"]'),hoverMode:this.shadowRoot.getElementById("hover-mode"),handleOnlyDrag:this.shadowRoot.getElementById("handle-only-drag"),dividerWidth:this.shadowRoot.getElementById("divider-width"),dividerColor:this.shadowRoot.getElementById("divider-color"),handleWidth:this.shadowRoot.getElementById("handle-width"),handleColor:this.shadowRoot.getElementById("handle-color"),hideHandle:this.shadowRoot.getElementById("hide-handle"),previewContainer:this.shadowRoot.getElementById("preview-container"),previewArea:this.shadowRoot.getElementById("preview-area"),previewPlaceholder:this.shadowRoot.getElementById("preview-placeholder"),previewError:this.shadowRoot.getElementById("preview-error"),generateButton:this.shadowRoot.getElementById("generate-btn")};e.successPopup=document.querySelector(".pop-up-success"),e.popupAcceptBtn=document.querySelector("[data-popup-accept-btn]"),e.popupCloseBtn=document.querySelector("[data-popup-close-btn]"),this.elements=e}bindEvents(){const e={handleGenerate:this.generateAndCopyCode.bind(this),handlePositionInput:()=>this.updatePositionDisplay(),handlePreviewUpdate:()=>this.updatePreview()};this.eventHandlers=e,this.elements.generateButton?.addEventListener("click",e.handleGenerate),this.elements.initialPosition?.addEventListener("input",e.handlePositionInput),this.elements.imageUrlBefore?.addEventListener("input",e.handlePreviewUpdate),this.elements.imageUrlAfter?.addEventListener("input",e.handlePreviewUpdate),this.elements.initialPosition?.addEventListener("input",e.handlePreviewUpdate),this.elements.orientationRadios?.forEach(t=>{t.addEventListener("change",e.handlePreviewUpdate)}),this.elements.hoverMode?.addEventListener("change",e.handlePreviewUpdate),this.elements.handleOnlyDrag?.addEventListener("change",e.handlePreviewUpdate),this.elements.dividerWidth?.addEventListener("input",e.handlePreviewUpdate),this.elements.dividerColor?.addEventListener("change",e.handlePreviewUpdate),this.elements.handleWidth?.addEventListener("input",e.handlePreviewUpdate),this.elements.handleColor?.addEventListener("change",e.handlePreviewUpdate),this.elements.hideHandle?.addEventListener("change",e.handlePreviewUpdate),this.bindModalEvents()}bindModalEvents(){if(this.elements.popupAcceptBtn){const e=()=>this.hideSuccessPopup();this.eventHandlers.set("popup-accept",e),this.elements.popupAcceptBtn.addEventListener("click",e)}if(this.elements.popupCloseBtn){const e=()=>this.hideSuccessPopup();this.eventHandlers.set("popup-close",e),this.elements.popupCloseBtn.addEventListener("click",e)}if(this.elements.successPopup){const e=e=>{e.target===this.elements.successPopup&&this.hideSuccessPopup()};this.eventHandlers.set("popup-overlay",e),this.elements.successPopup.addEventListener("click",e)}}setInitialState(){this.updatePositionDisplay(),this.loadSliderLibrary(()=>{this.updatePreview()})}updatePositionDisplay(){const{initialPosition:e,initialPositionValue:t}=this.elements;e&&t&&(t.textContent=`${e.value}%`)}loadSliderLibrary(e){const t="https://cdn.jsdelivr.net/npm/img-comparison-slider@8/dist/index.js",i="https://cdn.jsdelivr.net/npm/img-comparison-slider@8/dist/styles.css";let n=!1,r=!1;const o=()=>{n&&r&&e()};if(document.querySelector(`link[href="${i}"]`))r=!0;else{const e=document.createElement("link");e.rel="stylesheet",e.href=i,e.onload=()=>{r=!0,o()},e.onerror=()=>{r=!0,o()},document.head.appendChild(e)}if(document.querySelector(`script[src="${t}"]`)){if(!window.customElements||!window.customElements.get("img-comparison-slider"))return void setTimeout(()=>{n=!0,o()},100);n=!0}else{const e=document.createElement("script");e.src=t,e.defer=!0,e.onload=()=>{window.customElements&&"function"==typeof window.customElements.whenDefined?window.customElements.whenDefined("img-comparison-slider").then(()=>{n=!0,o()}).catch(()=>{n=!0,o()}):setTimeout(()=>{n=!0,o()},200)},e.onerror=()=>{n=!0,o()},document.head.appendChild(e)}o()}updatePreview(){const{previewArea:e,previewPlaceholder:t,previewError:i,previewContainer:n}=this.elements;if(!e||!n)return;const r={imageUrlBefore:this.elements.imageUrlBefore?.value.trim()||"",imageUrlAfter:this.elements.imageUrlAfter?.value.trim()||"",initialPosition:parseInt(this.elements.initialPosition?.value,10)||50,orientation:this.shadowRoot.querySelector('input[name="orientation"]:checked')?.value||"horizontal",hoverMode:this.elements.hoverMode?.checked||!1,handleOnlyDrag:this.elements.handleOnlyDrag?.checked||!1,dividerWidth:parseInt(this.elements.dividerWidth?.value,10)||1,dividerColor:this.elements.dividerColor?.value||"#ffffff",handleWidth:parseInt(this.elements.handleWidth?.value,10)||40,handleColor:this.elements.handleColor?.value||"#ffffff",hideHandle:this.elements.hideHandle?.checked||!1};if(t&&(t.style.display="none"),i&&(i.style.display="none"),!r.imageUrlBefore||!r.imageUrlAfter){t&&(t.style.display="block");const i=e.querySelector("img-comparison-slider");return void(i&&i.remove())}const o=e=>!e||!(e.startsWith("http:")||e.startsWith("https:")||e.startsWith("/")||e.startsWith("data:"));let s=!1;if((o(r.imageUrlBefore)||o(r.imageUrlAfter))&&(s=!0),s&&(r.imageUrlBefore||r.imageUrlAfter)){i&&(i.textContent="Ошибка: URL должен начинаться с http://, https:// или /",i.style.display="block");const t=e.querySelector("img-comparison-slider");t&&t.remove()}else this.createPreviewSlider(r)}createPreviewSlider(e){const{previewArea:t,previewError:i}=this.elements;if(!window.customElements||!window.customElements.get("img-comparison-slider"))return void(i&&(i.textContent="Библиотека слайдера не загружена",i.style.display="block"));const n=t.querySelector("img-comparison-slider");n&&n.remove();const r=document.createElement("img-comparison-slider");r.style.width="100%",r.style.height="100%",r.style.outline="none",r.setAttribute("tabindex","-1"),r.setAttribute("value",e.initialPosition),r.setAttribute("direction",e.orientation),e.hoverMode&&r.setAttribute("hover","true"),e.handleOnlyDrag&&r.setAttribute("handle","true"),e.dividerWidth>=0&&r.style.setProperty("--divider-width",`${e.dividerWidth}px`),e.dividerColor&&r.style.setProperty("--divider-color",e.dividerColor),e.handleWidth>=0&&r.style.setProperty("--default-handle-width",`${e.handleWidth}px`),e.handleColor&&r.style.setProperty("--default-handle-color",e.handleColor),r.style.setProperty("--default-handle-opacity",e.hideHandle?"0":"1");const o=document.createElement("img");o.setAttribute("slot","first"),o.setAttribute("src",e.imageUrlBefore),o.setAttribute("alt","Изображение До"),o.style.width="100%",o.style.height="auto",o.style.display="block",o.onerror=()=>{i&&(i.textContent='Не удалось загрузить изображение "ДО"',i.style.display="block",r.style.display="none")},o.onload=()=>{r.style.display="",i&&(i.style.display="none")};const s=document.createElement("img");s.setAttribute("slot","second"),s.setAttribute("src",e.imageUrlAfter),s.setAttribute("alt","Изображение После"),s.style.width="100%",s.style.height="auto",s.style.display="block",s.onerror=()=>{i&&(i.textContent='Не удалось загрузить изображение "ПОСЛЕ"',i.style.display="block",r.style.display="none")},s.onload=()=>{r.style.display="",i&&(i.style.display="none")},r.appendChild(o),r.appendChild(s),t.appendChild(r)}collectData(){const e=this.elements.imageUrlBefore?.value.trim()||"",t=this.elements.imageUrlAfter?.value.trim()||"",i=this.elements.containerSelector?.value.trim().replace(/^\./,"")||"";if(!e||!t)return alert("Укажите URL для обоих изображений."),null;if(!i)return alert("Укажите CSS-класс блока-контейнера."),null;if(!/^[a-zA-Z0-9_-]+$/.test(i))return alert(`Класс контейнера "${i}" содержит недопустимые символы.`),null;const n=this.shadowRoot.querySelector('input[name="orientation"]:checked')?.value||"horizontal";return{imageUrlBefore:e,imageUrlAfter:t,containerSelector:i,initialPosition:parseInt(this.elements.initialPosition?.value,10)||50,orientation:n,hoverMode:this.elements.hoverMode?.checked||!1,handleOnlyDrag:this.elements.handleOnlyDrag?.checked||!1,dividerWidth:parseInt(this.elements.dividerWidth?.value,10)||1,dividerColor:this.elements.dividerColor?.value||"#ffffff",handleWidth:parseInt(this.elements.handleWidth?.value,10)||40,handleColor:this.elements.handleColor?.value||"#ffffff",hideHandle:this.elements.hideHandle?.checked||!1}}generateCode(e){return`<script>\n/* Generated by BeforeAfterSliderGenerator */\ndocument.addEventListener('DOMContentLoaded', () => {\n  const config = ${JSON.stringify(e,null,2)};\n  const sliderLibraryUrl = 'https://cdn.jsdelivr.net/npm/img-comparison-slider@8/dist/index.js';\n  const sliderStylesUrl = 'https://cdn.jsdelivr.net/npm/img-comparison-slider@8/dist/styles.css';\n  let scriptLoaded = false;\n  let stylesLoaded = false;\n\n  const initSlider = () => {\n    if (!scriptLoaded || !stylesLoaded) { \n      console.log('[BeforeAfterSlider] Ожидание ресурсов...'); \n      return; \n    }\n    \n    if (!config.containerSelector) { \n      console.error('[BeforeAfterSlider] Ошибка: Класс контейнера не указан.'); \n      return; \n    }\n    \n    const container = document.querySelector('.' + config.containerSelector);\n    if (!container) { \n      console.error('[BeforeAfterSlider] Ошибка: Контейнер "' + config.containerSelector + '" не найден.'); \n      return; \n    }\n    \n    if (container.querySelector('img-comparison-slider')) { \n      console.warn('[BeforeAfterSlider] Слайдер в "' + config.containerSelector + '" уже есть.'); \n      return; \n    }\n\n    const slider = document.createElement('img-comparison-slider');\n    slider.setAttribute('value', config.initialPosition != null ? config.initialPosition : 50);\n    slider.setAttribute('direction', config.orientation || 'horizontal');\n    if (config.hoverMode) { slider.setAttribute('hover', 'true'); }\n    if (config.handleOnlyDrag) { slider.setAttribute('handle', 'true'); }\n    slider.setAttribute('tabindex', '0');\n    slider.style.outline = 'none';\n\n    // Применение стилей через CSS переменные\n    if (config.dividerWidth != null && config.dividerWidth >= 0) {\n      slider.style.setProperty('--divider-width', config.dividerWidth + 'px');\n    }\n    if (config.dividerColor) {\n      slider.style.setProperty('--divider-color', config.dividerColor);\n    }\n    if (config.handleWidth != null && config.handleWidth >= 0) {\n      slider.style.setProperty('--default-handle-width', config.handleWidth + 'px');\n    }\n    if (config.handleColor) {\n      slider.style.setProperty('--default-handle-color', config.handleColor);\n    }\n    slider.style.setProperty('--default-handle-opacity', config.hideHandle ? '0' : '1');\n\n    // Создание изображений с корректным масштабированием\n    const imgBefore = document.createElement('img');\n    imgBefore.setAttribute('slot', 'first');\n    imgBefore.setAttribute('src', config.imageUrlBefore);\n    imgBefore.setAttribute('alt', 'Изображение До');\n    imgBefore.style.width = '100%';\n    imgBefore.style.height = 'auto';\n    imgBefore.style.display = 'block';\n\n    const imgAfter = document.createElement('img');\n    imgAfter.setAttribute('slot', 'second');\n    imgAfter.setAttribute('src', config.imageUrlAfter);\n    imgAfter.setAttribute('alt', 'Изображение После');\n    imgAfter.style.width = '100%';\n    imgAfter.style.height = 'auto';\n    imgAfter.style.display = 'block';\n\n    slider.appendChild(imgBefore);\n    slider.appendChild(imgAfter);\n    container.appendChild(slider);\n    console.log('[BeforeAfterSlider] Слайдер добавлен в "' + config.containerSelector + '".');\n  };\n\n  const loadScript = (url, callback) => {\n    if (document.querySelector('script[src="' + url + '"]')) {\n      if (window.customElements && window.customElements.get('img-comparison-slider')) {\n        console.log('[BeforeAfterSlider] Скрипт библиотеки уже загружен.');\n        scriptLoaded = true;\n        callback();\n      } else {\n        console.log('[BeforeAfterSlider] Ожидание регистрации компонента...');\n        const checkInterval = setInterval(() => {\n          if (window.customElements && window.customElements.get('img-comparison-slider')) {\n            clearInterval(checkInterval);\n            console.log('[BeforeAfterSlider] Компонент зарегистрирован.');\n            scriptLoaded = true;\n            callback();\n          }\n        }, 100);\n        setTimeout(() => {\n          if (!scriptLoaded) {\n            clearInterval(checkInterval);\n            console.error('[BeforeAfterSlider] Компонент не зарегистрирован.');\n            scriptLoaded = true;\n            callback();\n          }\n        }, 5000);\n      }\n      return;\n    }\n\n    const scriptTag = document.createElement('script');\n    scriptTag.src = url;\n    scriptTag.defer = true;\n    scriptTag.onload = () => {\n      if (window.customElements && typeof window.customElements.whenDefined === 'function') {\n        window.customElements.whenDefined('img-comparison-slider').then(() => {\n          console.log('[BeforeAfterSlider] Скрипт загружен, компонент зарегистрирован.');\n          scriptLoaded = true;\n          callback();\n        }).catch(err => {\n          console.error('[BeforeAfterSlider] Ошибка ожидания регистрации:', err);\n          scriptLoaded = true;\n          callback();\n        });\n      } else {\n        console.warn('[BeforeAfterSlider] customElements.whenDefined не поддерживается.');\n        setTimeout(() => {\n          console.log('[BeforeAfterSlider] Скрипт загружен (с задержкой).');\n          scriptLoaded = true;\n          callback();\n        }, 200);\n      }\n    };\n    scriptTag.onerror = () => {\n      console.error('[BeforeAfterSlider] Ошибка загрузки скрипта:', url);\n      scriptLoaded = true;\n      callback();\n    };\n    document.head.appendChild(scriptTag);\n  };\n\n  const loadStyles = (url, callback) => {\n    if (document.querySelector('link[href="' + url + '"]')) {\n      console.log('[BeforeAfterSlider] Стили уже загружены.');\n      stylesLoaded = true;\n      callback();\n      return;\n    }\n\n    const linkTag = document.createElement('link');\n    linkTag.rel = 'stylesheet';\n    linkTag.href = url;\n    let stylesTimer = null;\n\n    linkTag.onload = () => {\n      clearTimeout(stylesTimer);\n      console.log('[BeforeAfterSlider] Стили загружены (onload).');\n      stylesLoaded = true;\n      callback();\n    };\n\n    linkTag.onerror = () => {\n      clearTimeout(stylesTimer);\n      console.error('[BeforeAfterSlider] Ошибка загрузки стилей:', url);\n      stylesLoaded = true;\n      callback();\n    };\n\n    document.head.appendChild(linkTag);\n    stylesTimer = setTimeout(() => {\n      if (!stylesLoaded) {\n        console.warn('[BeforeAfterSlider] Стили не загрузились (таймаут).');\n        stylesLoaded = true;\n        callback();\n      }\n    }, 1500);\n  };\n\n  loadStyles(sliderStylesUrl, () => {\n    loadScript(sliderLibraryUrl, () => {\n      initSlider();\n    });\n  });\n});\n<\/script>`}async minifyGeneratedCode(e){try{const t=this.parseGeneratedCode(e),i=t.js?this.minifyJS(t.js):"",n=t.html?this.minifyHTML(t.html):"";let r="";return n&&(r+=n),i&&(r+=`<script>${i}<\/script>`),r}catch(t){return console.warn("Минификация генерируемого кода не удалась, используем оригинал:",t),e}}parseGeneratedCode(e){const t={js:"",html:""},i=/<script[^>]*>([\s\S]*?)<\/script>/gi;let n;for(;null!==(n=i.exec(e));)t.js+=n[1];return t.html=e.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").trim(),t}minifyHTML(e){return e?e.replace(/<!--[\s\S]*?-->/g,"").replace(/>\s+</g,"><").replace(/\s+/g," ").trim():""}minifyJS(e){let t=e;return t=this.removeJSComments(t),t=t.replace(/const\s+([a-zA-Z_$][a-zA-Z0-9_$]*)\s*=\s*/g,"const $1=").replace(/let\s+([a-zA-Z_$][a-zA-Z0-9_$]*)\s*=\s*/g,"let $1=").replace(/var\s+([a-zA-Z_$][a-zA-Z0-9_$]*)\s*=\s*/g,"var $1="),t=t.replace(/{\s*([^}]+)\s*}/g,(e,t)=>`{${t.replace(/\s*:\s*/g,":").replace(/\s*,\s*/g,",")}}`).replace(/\[\s*([^\]]+)\s*\]/g,(e,t)=>`[${t.replace(/\s*,\s*/g,",")}]`),t=t.replace(/\s*([=+\-*/%<>&|!])\s*/g,"$1").replace(/\s*([(){}[\];,])\s*/g,"$1").replace(/\s+/g," ").replace(/\b(if|for|while|switch|catch|function|return|throw|new|typeof)\s+/g,"$1 ").replace(/\belse\s+/g,"else ").replace(/\s*\n\s*/g,"\n").replace(/\n+/g,"\n").trim(),t=t.replace(/\btrue\b(?=\s*[,;\}\)\]])/g,"!0").replace(/\bfalse\b(?=\s*[,;\}\)\]])/g,"!1").replace(/\bundefined\b(?=\s*[,;\}\)\]])/g,"void 0"),t}removeJSComments(e){let t="",i=!1,n="",r=!1,o=!1;for(let s=0;s<e.length;s++){const l=e[s],a=e[s+1]||"";if(!r&&!o){if(!(i||'"'!==l&&"'"!==l&&"`"!==l)){i=!0,n=l,t+=l;continue}if(i&&l===n&&"\\"!==e[s-1]){i=!1,t+=l;continue}if(i){t+=l;continue}}if(!i){if(!r&&!o&&"/"===l&&"*"===a){r=!0,s++;continue}if(r&&"*"===l&&"/"===a){r=!1,s++;continue}if(!r&&!o&&"/"===l&&"/"===a){o=!0,s++;continue}if(o&&("\n"===l||"\r"===l)){o=!1,t+=l;continue}}r||o||(t+=l)}return t}async generateAndCopyCode(){const e=this.collectData();if(null===e)return;const t=this.generateCode(e),i=await this.minifyGeneratedCode(t);try{await this.copyToClipboard(i),this.showSuccessPopup()}catch(e){console.error("Не удалось скопировать код:",e)}}async copyToClipboard(e){if(navigator.clipboard)try{return void await navigator.clipboard.writeText(e)}catch(e){console.log("Ошибка clipboard API:",e)}const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",t.style.left="-9999px",document.body.appendChild(t);try{t.select(),document.execCommand("copy")}finally{document.body.removeChild(t)}}showSuccessPopup(){this.elements.successPopup&&(this.elements.successPopup.style.display="flex")}hideSuccessPopup(){this.elements.successPopup&&(this.elements.successPopup.style.display="none")}unbindEvents(){this.elements.generateButton&&this.eventHandlers.handleGenerate&&this.elements.generateButton.removeEventListener("click",this.eventHandlers.handleGenerate),this.elements.initialPosition&&this.eventHandlers.handlePositionInput&&this.elements.initialPosition.removeEventListener("input",this.eventHandlers.handlePositionInput),this.eventHandlers.handlePreviewUpdate&&(this.elements.imageUrlBefore?.removeEventListener("input",this.eventHandlers.handlePreviewUpdate),this.elements.imageUrlAfter?.removeEventListener("input",this.eventHandlers.handlePreviewUpdate),this.elements.initialPosition?.removeEventListener("input",this.eventHandlers.handlePreviewUpdate),this.elements.orientationRadios?.forEach(e=>{e.removeEventListener("change",this.eventHandlers.handlePreviewUpdate)}),this.elements.hoverMode?.removeEventListener("change",this.eventHandlers.handlePreviewUpdate),this.elements.handleOnlyDrag?.removeEventListener("change",this.eventHandlers.handlePreviewUpdate),this.elements.dividerWidth?.removeEventListener("input",this.eventHandlers.handlePreviewUpdate),this.elements.dividerColor?.removeEventListener("change",this.eventHandlers.handlePreviewUpdate),this.elements.handleWidth?.removeEventListener("input",this.eventHandlers.handlePreviewUpdate),this.elements.handleColor?.removeEventListener("change",this.eventHandlers.handlePreviewUpdate),this.elements.hideHandle?.removeEventListener("change",this.eventHandlers.handlePreviewUpdate),this.elements.previewWidth?.removeEventListener("input",this.eventHandlers.handlePreviewUpdate),this.elements.previewHeight?.removeEventListener("input",this.eventHandlers.handlePreviewUpdate)),this.eventHandlers.has("popup-accept")&&this.elements.popupAcceptBtn?.removeEventListener("click",this.eventHandlers.get("popup-accept")),this.eventHandlers.has("popup-close")&&this.elements.popupCloseBtn?.removeEventListener("click",this.eventHandlers.get("popup-close")),this.eventHandlers.has("popup-overlay")&&this.elements.successPopup?.removeEventListener("click",this.eventHandlers.get("popup-overlay")),this.eventHandlers.clear()}destroy(){this.unbindEvents(),this.initialized=!1,console.log("BeforeAfterSliderGenerator: Генератор уничтожен")}}customElements.define("before-after-slider-generator",BeforeAfterSliderGenerator);